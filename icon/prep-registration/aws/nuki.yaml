---

aws_regions_:
  type: aws_regions

region:
  type: select
  message: Which region do you want to deploy into?
  choices: "{{ nuki.aws_regions_ }}"

# Label
reg_keys_:
  type: stat
  loop: "{{ nuki.settings_.registration_id_label_order }}"
  input: "{{ nuki[nuki.item] }}"

registration_name_:
  type: join
  input: "{{ nuki.reg_keys_ }}"

# Profiles
keystore_:
  type: nukikata
  context_file: "{{ nuki.scripts_dir_ }}/keystore.yaml"
  existing_context: "{{ nuki }}"

## Action
#register_action_:
#  type: select
#  message: How do you want to register?
#  choice:
#    prompt: Be prompted for choices
#    fill: Fill out yaml

# Prompt
register_prompt_:
  type: nukikata
  context_file: "{{ nuki.scripts_dir_ }}/registration.yaml"
#  existing_context:
#    registration_name_: "{{ nuki.registration_name_ }}"
  
register_prompt_write_:
  type: nukikata
  context_file: "{{ nuki.scripts_dir_ }}/registration_write.yaml"
  existing_context: "{{ nuki }}"

# Apply
apply_confirm_:
  type: confirm
  message: Do you want deploy now?

create_run_file_:
  type: yaml
  path: "{{ nuki.run_file_ }}"
  contents: "{{ nuki }}"
  filter: "{{ nuki.settings_.registration_id_label_order }}"

apply_:
  type: shell
  command: terragrunt apply --terragrunt-non-interactive
